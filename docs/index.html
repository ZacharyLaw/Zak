<!doctype html>
<html>
<head>
<style>
  #header {
  position: fixed;
  width: 100%;
  color:white;
  padding: 10px;
  }
  #footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  color:white;
  overflow-x: auto;
  white-space: nowrap;
  z-index: 2;
  min-height: 20%;
  }
  #inventory{
  width: 100%;
  overflow-x: auto;
  white-space: nowrap;

  }
  body{
  color:white;
  position:static !important;
  margin: 0;
  padding: 0;
  overflow:hidden
  }
  button {
  background-color: inherit;
  border: none;
  outline: none;
  }

  button:hover {
  background-color: #ddd;
  }
  #sandbox{
    overflow:hidden;
  }
</style>
</head>
<body style="background-color:#36393F;">
<div id="header" style="background-color:#2F3136;">
  <table style="width: 95%;" >
    <tbody>
      <tr>
        <td style="text-align: left;width: 30%;"><output>0% 0/0</output></td>
        <td style="text-align: center;width: 30%;">Space Arena Builder</td>
        <td style="text-align: right;width: 30%;"><a id="download" href="#" style="color:white;">Download</a></td>
      </tr>
    </tbody>
    </table>
</div>
<br><br><br>    <div id="stage-parent" >  <div id="c" style="position: fixed"></div></div>Drag to move<br>Double tap to remove  <!--style="display: none;"-->
<div id="footer" style="background-color:#2F3136;">
Inventory: Click to insert&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" id="myInput" onkeyup="search()" placeholder="Search module.." >
<button id="util" style="float: right;"><img src="utility.png" width="30" height="30"></button>
<button id="def" style="float: right;"><img src="defense.png" width="30" height="30"></button>
<button id="weap" style="float: right;"><img src="weapon.png"  width="30" height="30"></button>
<button id="all" style="float: right; color: white;">ALL</button>
<button  style="float: right; color: white;   background-color: #2F3136;">Category: </button>
<div id="inventory" style="position: absolute; bottom: 0%;">
<img class="inven weap" src="chaingun.png" eng="-10" width="25">
<img class="inven weap" src="chaingunmk2.png" eng="-10" width="25">
<img class="inven weap" src="vulcancannon.png" eng="-20" width="25">
<img class="inven weap" src="vulcanturret.png" eng="-45" width="50">
<img class="inven weap" src="vulcanturretmk2.png" eng="-30" width="50">
<img class="inven weap" src="vulcanturretmk3.png" eng="-55" width="50">
<img class="inven weap" src="railgun.png" eng="-30" width="25">
<img class="inven weap" src="railgunmk2.png" eng="-25" width="25">
<img class="inven weap" src="quantumrifle.png" eng="-70" width="25">
<img class="inven weap" src="gaussianshotgun.png" eng="-70" width="50">
<img class="inven weap" src="massdriver.png" eng="-70" width="50">
<img class="inven weap" src="massdrivermk2.png" eng="-70" width="50">
<img class="inven weap" src="railturret.png" eng="-110" width="75">
<img class="inven weap" src="railturretmk2.png" eng="-110" width="75">
<img class="inven weap" src="gaussrifle.png" eng="-60" width="25">
<img class="inven weap" src="quantumturret.png" eng="-150" width="75">
<img class="inven weap" src="quantumturretmk2.png" eng="-150" width="75">
<img class="inven weap" src="hyperionchaingun.png" eng="-90" width="50">
<img class="inven weap" src="gaussianwarshotgun.png" eng="-155" width="75">
<img class="inven weap" src="capitalcannon.png" eng="-280" width="50">
<img class="inven weap" src="capitalcannonmk2.png" eng="-280" width="50">
<img class="inven weap" src="rocketlauncher.png" eng="-30" width="25">
<img class="inven weap" src="rocketlaunchermk2.png" eng="-100" width="25">
<img class="inven weap" src="rocketturret.png" eng="-60" width="50">
<img class="inven weap" src="rocketturretmk2.png" eng="-60" width="50">
<img class="inven weap" src="rocketturretmk3.png" eng="-60" width="50">
<img class="inven weap" src="missilelauncher.png" eng="-50" width="25">
<img class="inven weap" src="minelauncher.png" eng="-70" width="75">
<img class="inven weap" src="minelaunchermk2.png" eng="-170" width="75">
<img class="inven weap" src="torpedolauncher.png" eng="-85" width="25">
<img class="inven weap" src="arsenalwall.png" eng="-140" width="100">
<img class="inven weap" src="scorpionlauncher.png" eng="-110" width="50">
<img class="inven weap" src="scorpionlaunchermk2.png" eng="-110" width="50">
<img class="inven weap" src="scorpionlaunchermk3.png" eng="-365" width="50">
<img class="inven weap" src="impactmissile.png" eng="-80" width="25">
<img class="inven weap" src="flakrocketturret.png" eng="-155" width="75">
<img class="inven weap" src="flakrocketturretmk2.png" eng="-155" width="75">
<img class="inven weap" src="warheadlauncher.png" eng="-160" width="50">
<img class="inven weap" src="hydraturret.png" eng="-195" width="75">
<img class="inven weap" src="hydraturretmk2.png" eng="-195" width="75">
<img class="inven weap" src="smalllaser.png" eng="-20" width="25">
<img class="inven weap" src="smalllasermk2.png" eng="25" width="25">
<img class="inven weap" src="laserbeam.png" eng="-40" width="25">
<img class="inven weap" src="laserbeammk2.png" eng="-30" width="25">
<img class="inven weap" src="laserbeammk3.png" eng="-40" width="25">
<img class="inven weap" src="laserturret.png" eng="-70" width="50">
<img class="inven weap" src="fusionray.png" eng="-65" width="25">
<img class="inven weap" src="pulselaser.png" eng="-100" width="50">
<img class="inven weap" src="pulselasermk2.png" eng="-100" width="50">
<img class="inven weap" src="fusionturret.png" eng="-200" width="75">
<img class="inven weap" src="pulselasermk3.png" eng="-150" width="50">
<img class="inven weap" src="arcfusionarray.png" eng="-180" width="50">
<img class="inven weap" src="meleefusionturret.png" eng="-300" width="100">
<img class="inven def" src=" smallsteelarmor.png" eng="0" width="25">
<img class="inven def" src=" smallsteelarmormk2.png" eng="0" width="25">
<img class="inven def" src=" smallsolararmor.png" eng="10" width="25">
<img class="inven def" src="mediumsteelarmor.png" eng="0" width="50">
<img class="inven def" src="mediumsolararmor.png" eng="50" width="50">
<img class="inven def" src="mediumsolararmormk2.png" eng="65" width="50">
<img class="inven def" src="plasmaarmor.png" eng="-15" width="25">
<img class="inven def" src=" smallreactivearmor.png" eng="-5" width="25">
<img class="inven def" src="largesteelarmor.png" eng="0" width="75">
<img class="inven def" src="largesolararmor.png" eng="125" width="75">
<img class="inven def" src="mediumreactivearmor.png" eng="-25" width="50">
<img class="inven def" src="largereactivearmor.png" eng="-60" width="75">
<img class="inven def" src="ballisticarmor.png" eng="0" width="75">
<img class="inven def" src="combatshield.png" eng="-60" width="25">
<img class="inven def" src="combatshieldmk2.png" eng="-70" width="25">
<img class="inven def" src="bunkershield.png" eng="-80" width="25">
<img class="inven def" src="bunkershieldmk2.png" eng="-20" width="25">
<img class="inven def" src="battleshield.png" eng="-135" width="25">
<img class="inven def" src="warshield.png" eng="-280" width="50">
<img class="inven def" src="warshieldmk2.png" eng="-350" width="50">
<img class="inven def" src="junklauncher.png" eng="-35" width="50">
<img class="inven def" src="pointdefenseturret.png" eng="-35" width="50">
<img class="inven def" src="pointdefenseturretmk2.png" eng="-25" width="50">
<img class="inven def" src="pointdefenseturretmk3.png" eng="-35" width="50">
<img class="inven util" src="smalliondrive.png" eng="-5" width="25">
<img class="inven util" src="smalliondrivemk2.png" eng="-5" width="25">
<img class="inven util" src="warpdrive.png" eng="-45" width="25">
<img class="inven util" src="vectoredthruster.png" eng="-30" width="50">
<img class="inven util" src="vectoredthrustermk2.png" eng="-40" width="50">
<img class="inven util" src="afterburner.png" eng="-30" width="25">
<img class="inven util" src="largeiondrive.png" eng="-25" width="50">
<img class="inven util" src="grandiondrive.png" eng="-40" width="50">
<img class="inven util" src="grandiondrivemk2.png" eng="-60" width="50">
<img class="inven util" src=" smallreactor.png" eng="50" width="25">
<img class="inven util" src="mediumreactor.png" eng="250" width="50">
<img class="inven util" src="mediumarmoredreactor.png" eng="160" width="50">
<img class="inven util" src="mediumarmoredreactormk2.png" eng="200" width="50">
<img class="inven util" src="mediumiondrive.png" eng="-70" width="50">
<img class="inven util" src="largereactor.png" eng="650" width="75">
<img class="inven util" src="largearmoredreactor.png" eng="400" width="75">
<img class="inven util" src="grandreactor.png" eng="1300" width="100">
<img class="inven util" src="repairbay.png" eng="-40" width="75">

</div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="jquery.mobile-monkey.js"></script>
<script src="jquery-doubletap.js"></script>
<script src="https://unpkg.com/konva@7.0.4/konva.min.js"></script>

<script>
var blockSize = 50;
var usage=0;
var energy=0;
var percent=0;
var stage = new Konva.Stage({
  container: 'c',
  width: window.innerWidth,
  height: window.innerHeight,
});
var layer = new Konva.Layer();

function fitStageIntoParentContainer() {
  stage.width(window.innerWidth)
  stage.height(window.innerHeight)

}
fitStageIntoParentContainer();

window.addEventListener('resize', fitStageIntoParentContainer);

function search() {
  if (document.getElementById("myInput").value==""){
    $("img").show();
  }
  var  li, a, i, txtValue;
  list = document.getElementsByClassName("inven");
  for (i = 0; i < list.length; i++) {
    txtValue = list[i].src.replace(".png","");
    if (txtValue.toUpperCase().indexOf(document.getElementById("myInput").value.toUpperCase()) > -1 && list[i].style.display == "") {
      list[i].style.display = "";
    } else {
      list[i].style.display = "none";
    }
  }
}
$( document ).ready( function() {


  $( ".inven" ).click( function(event) {
    var imageObj = new Image();
      imageObj.src = $(this).attr("src");
      imageObj.eng = $(this).attr("eng");
      imageObj.onload = function () {
        drawImage(imageObj);
      };
    $(this).mousedown(function(event) {
    if (event.which==3){
    $(this).remove();
    if ($(this).attr("eng")<0){
  usage-=$(this).attr("eng")*(-1);
}else{
  energy-=$(this).attr("eng")*(1);
}

    if(usage==0){
        percent=0;
      }else if(energy/usage*100>100){
        percent=100;
      }
      else{
        percent=Math.round(energy/usage*100);
      }
      $("output").html(percent+"% "+usage+"/"+energy);

    };
});
if ($(this).attr("eng")<0){
  usage+=$(this).attr("eng")*(-1);
}else{
  energy+=$(this).attr("eng")*(1);
}
if(usage==0){
  percent=0;
}else if(energy/usage*100>100){
  percent=100;
}
else{
  percent=Math.round(energy/usage*100);
}

$("output").html(percent+"% "+usage+"/"+energy);

});
$('button').click( function(event) {
  if ($(this).attr('id')=="all"){
    $(".weap, .def, .util").show();
  }else{
  $(".weap, .def, .util").hide();
  $("."+$(this).attr('id')).show();
  }
});

$("#download").click(function () {
    var trim=trimCanvas($('canvas')[0]);
    $("#download").attr("download","build.png").attr("href",trim.toDataURL("image/png").replace(/^data:image\/png/,"data:application/octet-stream"));
});

});//ready
function drawImage(imageObj) {
        var img = new Konva.Image({
          image: imageObj,
          draggable: true,
          eng: imageObj.eng
        });
        img.on('mouseover', function () {
          document.body.style.cursor = 'move';
        });
        img.on('mouseout', function () {
          document.body.style.cursor = 'default';
        });
        img.on('dblclick', function () {
          img.destroy();
          layer.batchDraw();
          document.body.style.cursor = 'default';
          if (img.attrs.eng<0){
usage-=img.attrs.eng*(-1);
}else{
energy-=img.attrs.eng;
}
if(usage==0){
percent=0;
}else if(energy/usage*100>100){
percent=100;
}else{
percent=Math.round(energy/usage*100);
}
$("output").html(percent+"% "+usage+"/"+energy);

        });
        img.on('dbltap', function () {
          img.destroy();
          layer.batchDraw();
          document.body.style.cursor = 'default';
          if (img.attrs.eng<0){
usage-=img.attrs.eng*(-1);
}else{
energy-=img.attrs.eng;
}
if(usage==0){
percent=0;
}else if(energy/usage*100>100){
percent=100;
}else{
percent=Math.round(energy/usage*100);
}
$("output").html(percent+"% "+usage+"/"+energy);

        });
        img.on('dragmove', (e) => {
          img.position({
              x: Math.round(img.x() / blockSize) * blockSize,
              y: Math.round(img.y() / blockSize) * blockSize
            });
            layer.batchDraw();
        });
        layer.add(img);
        stage.add(layer);
      }
function trimCanvas(c) {
    var ctx = c.getContext('2d'),
        copy = document.createElement('canvas').getContext('2d'),
        pixels = ctx.getImageData(0, 0, c.width, c.height),
        l = pixels.data.length,
        i,
        bound = {
            top: null,
            left: null,
            right: null,
            bottom: null
        },
        x, y;
    for (i = 0; i < l; i += 4) {
        if (pixels.data[i + 3] !== 0) {
            x = (i / 4) % c.width;
            y = ~~((i / 4) / c.width);

            if (bound.top === null) {
                bound.top = y;
            }

            if (bound.left === null) {
                bound.left = x;
            } else if (x < bound.left) {
                bound.left = x;
            }

            if (bound.right === null) {
                bound.right = x;
            } else if (bound.right < x) {
                bound.right = x;
            }

            if (bound.bottom === null) {
                bound.bottom = y;
            } else if (bound.bottom < y) {
                bound.bottom = y;
            }
        }
    }
    var trimHeight = bound.bottom - bound.top,
        trimWidth = bound.right - bound.left,
        trimmed = ctx.getImageData(bound.left, bound.top, trimWidth, trimHeight);
    copy.canvas.width = trimWidth+1*1;
    copy.canvas.height = trimHeight+1*1;
    copy.putImageData(trimmed, 0, 0);
    return copy.canvas;
}
      
</script>
</body>
</html>
