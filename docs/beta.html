<!doctype html>
<html><head>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
</head>
<body>
<div id="sandbox">
    <img class="ui-draggable ui-draggable-handle" src="chaingun.png" eng="-10" width="25" style="width: 50px; position: relative;left: 0px; top: 0px;">
    <img class="ui-draggable ui-draggable-handle" src="chaingunmk2.png" eng="-10" width="25" style="width: 50px; position: relative; left:-50px; top: 50px;">

</div>
<input id="preview" type="button" value="Preview">
<a id="download" href="#">Download</a>
<br>
<script>
$(document).ready(function(){
$("#preview").click(function () {
    var getCanvas=$('<canvas id="myCanvas" style="border:dotted;" height="'+window.innerHeight+'" width="'+window.innerHeight+'">');//style="display: none;"
    getCanvas.insertAfter("br");
    var ctx=$("#myCanvas")[0].getContext("2d");
    var relativel=0;
    var image,l,t;
    $('#sandbox img').each(function(){
        var image = new Image();
        image.src = $(this).attr('src');
        if ($(this).css("left")){
            l=$(this).css("left").replace("px","");
        }else{
            l=0;
        }
        if ($(this).css("top")){
            t=$(this).css("top").replace("px","");
        }else{
            t=0;
        }
        ctx.drawImage(image, relativel*1+l*1,t);
        relativel+=l*1+$(this).width()*1;
    }); 
    trimCanvas($("#myCanvas")[0]);
})

$("#download").click(function () {    $("#download").attr("download", "your_pic_name.png").attr("href", document.getElementById("myCanvas").toDataURL("image/png").replace(/^data:image\/png/, "data:application/octet-stream"));
});

});
function trimCanvas(c) {
    var ctx = c.getContext('2d'),
        copy = document.createElement('canvas').getContext('2d'),
        pixels = ctx.getImageData(0, 0, c.width, c.height),
        l = pixels.data.length,
        i,
        bound = {
            top: null,
            left: null,
            right: null,
            bottom: null
        },
        x, y;
    
    // Iterate over every pixel to find the highest
    // and where it ends on every axis ()
    for (i = 0; i < l; i += 4) {
        if (pixels.data[i + 3] !== 0) {
            x = (i / 4) % c.width;
            y = ~~((i / 4) / c.width);

            if (bound.top === null) {
                bound.top = y;
            }

            if (bound.left === null) {
                bound.left = x;
            } else if (x < bound.left) {
                bound.left = x;
            }

            if (bound.right === null) {
                bound.right = x;
            } else if (bound.right < x) {
                bound.right = x;
            }

            if (bound.bottom === null) {
                bound.bottom = y;
            } else if (bound.bottom < y) {
                bound.bottom = y;
            }
        }
    }
    
    // Calculate the height and width of the content
    var trimHeight = bound.bottom - bound.top,
        trimWidth = bound.right - bound.left,
        trimmed = ctx.getImageData(bound.left, bound.top, trimWidth, trimHeight);

    copy.canvas.width = trimWidth;
    copy.canvas.height = trimHeight;
    copy.putImageData(trimmed, 0, 0);

    // Return trimmed canvas
    return copy.canvas;
}
</script>
</body>
</html>
